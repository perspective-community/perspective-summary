!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@lumino/algorithm"),require("@lumino/coreutils"),require("@lumino/disposable"),require("@lumino/domutils"),require("@lumino/keyboard"),require("@lumino/signaling")):"function"==typeof define&&define.amd?define(["exports","@lumino/algorithm","@lumino/coreutils","@lumino/disposable","@lumino/domutils","@lumino/keyboard","@lumino/signaling"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).lumino_commands={},e.lumino_algorithm,e.lumino_coreutils,e.lumino_disposable,e.lumino_domutils,e.lumino_keyboard,e.lumino_signaling)}(this,(function(e,t,i,n,r,s,o){"use strict";class a{constructor(){this._timerID=0,this._timerModifierID=0,this._replaying=!1,this._keystrokes=[],this._keydownEvents=[],this._keyBindings=[],this._exactKeyMatch=null,this._commands=new Map,this._commandChanged=new o.Signal(this),this._commandExecuted=new o.Signal(this),this._keyBindingChanged=new o.Signal(this),this._holdKeyBindingPromises=new Map}get commandChanged(){return this._commandChanged}get commandExecuted(){return this._commandExecuted}get keyBindingChanged(){return this._keyBindingChanged}get keyBindings(){return this._keyBindings}listCommands(){return Array.from(this._commands.keys())}hasCommand(e){return this._commands.has(e)}addCommand(e,t){if(this._commands.has(e))throw new Error(`Command '${e}' already registered.`);return this._commands.set(e,l.createCommand(t)),this._commandChanged.emit({id:e,type:"added"}),new n.DisposableDelegate((()=>{this._commands.delete(e),this._commandChanged.emit({id:e,type:"removed"})}))}notifyCommandChanged(e){if(void 0!==e&&!this._commands.has(e))throw new Error(`Command '${e}' is not registered.`);this._commandChanged.emit({id:e,type:e?"changed":"many-changed"})}describedBy(e,t=i.JSONExt.emptyObject){var n;let r=this._commands.get(e);return Promise.resolve(null!==(n=null==r?void 0:r.describedBy.call(void 0,t))&&void 0!==n?n:{args:null})}label(e,t=i.JSONExt.emptyObject){var n;let r=this._commands.get(e);return null!==(n=null==r?void 0:r.label.call(void 0,t))&&void 0!==n?n:""}mnemonic(e,t=i.JSONExt.emptyObject){let n=this._commands.get(e);return n?n.mnemonic.call(void 0,t):-1}icon(e,t=i.JSONExt.emptyObject){var n;return null===(n=this._commands.get(e))||void 0===n?void 0:n.icon.call(void 0,t)}iconClass(e,t=i.JSONExt.emptyObject){let n=this._commands.get(e);return n?n.iconClass.call(void 0,t):""}iconLabel(e,t=i.JSONExt.emptyObject){let n=this._commands.get(e);return n?n.iconLabel.call(void 0,t):""}caption(e,t=i.JSONExt.emptyObject){let n=this._commands.get(e);return n?n.caption.call(void 0,t):""}usage(e,t=i.JSONExt.emptyObject){let n=this._commands.get(e);return n?n.usage.call(void 0,t):""}className(e,t=i.JSONExt.emptyObject){let n=this._commands.get(e);return n?n.className.call(void 0,t):""}dataset(e,t=i.JSONExt.emptyObject){let n=this._commands.get(e);return n?n.dataset.call(void 0,t):{}}isEnabled(e,t=i.JSONExt.emptyObject){let n=this._commands.get(e);return!!n&&n.isEnabled.call(void 0,t)}isToggled(e,t=i.JSONExt.emptyObject){let n=this._commands.get(e);return!!n&&n.isToggled.call(void 0,t)}isToggleable(e,t=i.JSONExt.emptyObject){let n=this._commands.get(e);return!!n&&n.isToggleable}isVisible(e,t=i.JSONExt.emptyObject){let n=this._commands.get(e);return!!n&&n.isVisible.call(void 0,t)}execute(e,t=i.JSONExt.emptyObject){let n,r=this._commands.get(e);if(!r)return Promise.reject(new Error(`Command '${e}' not registered.`));try{n=r.execute.call(void 0,t)}catch(e){n=Promise.reject(e)}let s=Promise.resolve(n);return this._commandExecuted.emit({id:e,args:t,result:s}),s}addKeyBinding(e){let i=l.createKeyBinding(e);return this._keyBindings.push(i),this._keyBindingChanged.emit({binding:i,type:"added"}),new n.DisposableDelegate((()=>{t.ArrayExt.removeFirstOf(this._keyBindings,i),this._keyBindingChanged.emit({binding:i,type:"removed"})}))}processKeydownEvent(e){if(e.defaultPrevented||this._replaying)return;const t=a.keystrokeForKeydownEvent(e);if(!t)return this._replayKeydownEvents(),void this._clearPendingState();if(a.isModifierKeyPressed(e)){let{exact:i}=l.matchKeyBinding(this._keyBindings,[t],e);return void(i?(e.preventDefault(),e.stopPropagation(),this._startModifierTimer(i)):this._clearModifierTimer())}this._keystrokes.push(t);const{exact:i,partial:n}=l.matchKeyBinding(this._keyBindings,this._keystrokes,e),r=0!==n.length;return i||r?(((null==i?void 0:i.preventDefault)||n.some((e=>e.preventDefault)))&&(e.preventDefault(),e.stopPropagation()),this._keydownEvents.push(e),i&&!r?(this._executeKeyBinding(i),void this._clearPendingState()):(i&&(this._exactKeyMatch=i),void this._startTimer())):(this._replayKeydownEvents(),void this._clearPendingState())}holdKeyBindingExecution(e,t){this._holdKeyBindingPromises.set(e,t)}processKeyupEvent(e){this._clearModifierTimer()}_startModifierTimer(e){this._clearModifierTimer(),this._timerModifierID=window.setTimeout((()=>{this._executeKeyBinding(e)}),l.modifierkeyTimeOut)}_clearModifierTimer(){0!==this._timerModifierID&&(clearTimeout(this._timerModifierID),this._timerModifierID=0)}_startTimer(){this._clearTimer(),this._timerID=window.setTimeout((()=>{this._onPendingTimeout()}),l.CHORD_TIMEOUT)}_clearTimer(){0!==this._timerID&&(clearTimeout(this._timerID),this._timerID=0)}_replayKeydownEvents(){0!==this._keydownEvents.length&&(this._replaying=!0,this._keydownEvents.forEach(l.replayKeyEvent),this._replaying=!1)}async _executeKeyBinding(e){if(0!==this._holdKeyBindingPromises.size){const e=[...this._keydownEvents],t=(await Promise.race([Promise.all(e.map((async e=>{var t;return null!==(t=this._holdKeyBindingPromises.get(e))&&void 0!==t?t:Promise.resolve(!0)}))),new Promise((e=>{setTimeout((()=>e([!1])),l.KEYBINDING_HOLD_TIMEOUT)}))])).every(Boolean);if(this._holdKeyBindingPromises.clear(),!t)return}let{command:t,args:i}=e,n={_luminoEvent:{type:"keybinding",keys:e.keys},...i};if(this.hasCommand(t)&&this.isEnabled(t,n))await this.execute(t,n);else{let i=this.hasCommand(t)?"enabled":"registered",n=`Cannot execute key binding '${e.keys.join(", ")}':`,r=`command '${t}' is not ${i}.`;console.warn(`${n} ${r}`)}}_clearPendingState(){this._clearTimer(),this._clearModifierTimer(),this._exactKeyMatch=null,this._keystrokes.length=0,this._keydownEvents.length=0}_onPendingTimeout(){this._timerID=0,this._exactKeyMatch?this._executeKeyBinding(this._exactKeyMatch):this._replayKeydownEvents(),this._clearPendingState()}}var l;!function(e){function t(e){let t="",i=!1,n=!1,s=!1,o=!1;for(let a of e.split(/\s+/))"Accel"===a?r.Platform.IS_MAC?n=!0:s=!0:"Alt"===a?i=!0:"Cmd"===a?n=!0:"Ctrl"===a?s=!0:"Shift"===a?o=!0:a.length>0&&(t=a);return{cmd:n,ctrl:s,alt:i,shift:o,key:t}}function i(e){let i="",n=t(e);return n.ctrl&&(i+="Ctrl "),n.alt&&(i+="Alt "),n.shift&&(i+="Shift "),n.cmd&&r.Platform.IS_MAC&&(i+="Cmd "),n.key?i+n.key:i.trim()}e.parseKeystroke=t,e.normalizeKeystroke=i,e.normalizeKeys=function(e){let t;return t=r.Platform.IS_WIN?e.winKeys||e.keys:r.Platform.IS_MAC?e.macKeys||e.keys:e.linuxKeys||e.keys,t.map(i)},e.formatKeystroke=function(e){return"string"==typeof e?i(e):e.map(i).join(", ");function i(e){let i=[],n=r.Platform.IS_MAC?" ":"+",s=t(e);return s.ctrl&&i.push("Ctrl"),s.alt&&i.push("Alt"),s.shift&&i.push("Shift"),r.Platform.IS_MAC&&s.cmd&&i.push("Cmd"),i.push(s.key),i.map(l.formatKey).join(n)}},e.isModifierKeyPressed=function(e){let t=s.getKeyboardLayout(),i=t.keyForKeydownEvent(e);return t.isModifierKey(i)},e.keystrokeForKeydownEvent=function(e){let t=s.getKeyboardLayout(),i=t.keyForKeydownEvent(e),n=[];return e.ctrlKey&&n.push("Ctrl"),e.altKey&&n.push("Alt"),e.shiftKey&&n.push("Shift"),e.metaKey&&r.Platform.IS_MAC&&n.push("Cmd"),t.isModifierKey(i)||n.push(i),n.join(" ")}}(a||(a={})),function(e){e.CHORD_TIMEOUT=1e3,e.KEYBINDING_HOLD_TIMEOUT=1e3,e.modifierkeyTimeOut=500,e.createCommand=function(e){return{execute:e.execute,describedBy:h("function"==typeof e.describedBy?e.describedBy:{args:null,...e.describedBy},(()=>({args:null}))),label:h(e.label,s),mnemonic:h(e.mnemonic,o),icon:h(e.icon,c),iconClass:h(e.iconClass,s),iconLabel:h(e.iconLabel,s),caption:h(e.caption,s),usage:h(e.usage,s),className:h(e.className,s),dataset:h(e.dataset,m),isEnabled:e.isEnabled||l,isToggled:e.isToggled||d,isToggleable:e.isToggleable||!!e.isToggled,isVisible:e.isVisible||l}},e.createKeyBinding=function(e){var t;return{keys:a.normalizeKeys(e),selector:u(e),command:e.command,args:e.args||i.JSONExt.emptyObject,preventDefault:null===(t=e.preventDefault)||void 0===t||t}},e.matchKeyBinding=function(e,t,i){let n=null,s=[],o=1/0,a=0;for(let l=0,d=e.length;l<d;++l){let d=e[l],m=y(d.keys,t);if(0===m)continue;if(2===m){-1!==g(d.selector,i)&&s.push(d);continue}let c=g(d.selector,i);if(-1===c||c>o)continue;let h=r.Selector.calculateSpecificity(d.selector);(!n||c<o||h>=a)&&(n=d,o=c,a=h)}return{exact:n,partial:s}},e.replayKeyEvent=function(e){e.target.dispatchEvent(function(e){let t=document.createEvent("Event"),i=e.bubbles||!0,n=e.cancelable||!0;return t.initEvent(e.type||"keydown",i,n),t.key=e.key||"",t.keyCode=e.keyCode||0,t.which=e.keyCode||0,t.ctrlKey=e.ctrlKey||!1,t.altKey=e.altKey||!1,t.shiftKey=e.shiftKey||!1,t.metaKey=e.metaKey||!1,t.view=e.view||window,t}(e))},e.formatKey=function(e){return r.Platform.IS_MAC?t.hasOwnProperty(e)?t[e]:e:n.hasOwnProperty(e)?n[e]:e};const t={Backspace:"⌫",Tab:"⇥",Enter:"⏎",Shift:"⇧",Ctrl:"⌃",Alt:"⌥",Escape:"⎋",PageUp:"⇞",PageDown:"⇟",End:"↘",Home:"↖",ArrowLeft:"←",ArrowUp:"↑",ArrowRight:"→",ArrowDown:"↓",Delete:"⌦",Cmd:"⌘"},n={Escape:"Esc",PageUp:"Page Up",PageDown:"Page Down",ArrowLeft:"Left",ArrowUp:"Up",ArrowRight:"Right",ArrowDown:"Down",Delete:"Del"},s=()=>"",o=()=>-1,l=()=>!0,d=()=>!1,m=()=>({}),c=()=>{};function h(e,t){return void 0===e?t:"function"==typeof e?e:()=>e}function u(e){if(-1!==e.selector.indexOf(","))throw new Error(`Selector cannot contain commas: ${e.selector}`);if(!r.Selector.isValid(e.selector))throw new Error(`Invalid selector: ${e.selector}`);return e.selector}function y(e,t){if(e.length<t.length)return 0;for(let i=0,n=t.length;i<n;++i)if(e[i]!==t[i])return 0;return e.length>t.length?2:1}function g(e,t){let i=t.target,n=t.currentTarget;for(let t=0;null!==i;i=i.parentElement,++t){if(i.hasAttribute("data-lm-suppress-shortcuts"))return-1;if(r.Selector.matches(i,e))return t;if(i===n)return-1}return-1}}(l||(l={})),e.CommandRegistry=a}));
//# sourceMappingURL=index.min.js.map